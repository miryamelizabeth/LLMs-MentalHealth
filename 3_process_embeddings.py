import dask.dataframe as dd
import pandas as pd
import json
import time
import os



## ===================================================================
def processGptEmbeddings(sourceDirectory, destinyDirectory):

	gloveTrain = pd.read_csv(r'dataset\users_train_eng.csv', usecols=['class', 'user_id'])
	gloveTest = pd.read_csv(r'dataset\user_test_eng.csv', usecols=['class', 'user_id'])

	todosUsers = pd.concat([gloveTrain, gloveTest])


	print(f'\nIniciando...\n')

	# keyNames = {'eat': 'ANOREXIA', 'harm': 'SELF-HARM', 'dep': 'DEPRESSION'}

	archivosLst = [f for f in os.listdir(sourceDirectory) if f.endswith('.jsonl')]

	trainLst = []
	testLst = []


	for archivo in archivosLst:
		
		print(f'*** {archivo} ***')
		start_time = time.time()

		file = open(os.path.join(sourceDirectory, archivo), 'r')
		lines = file.readlines()

		for line in lines:
			
			json_object = json.loads(line)
			
			identifier = json_object['custom_id'] # "eat_test_s9419_t18"
			embedding = json_object['response']['body']['data'][0]['embedding']

			userID = identifier.split('_')[2].replace('s', 'subject')			
			partition = identifier.split('_')[1]

			labelClass = todosUsers[todosUsers['user_id'] == userID]['class'].values.tolist()[0]

			guardar = [labelClass, userID] + embedding

			if partition == 'train':
				trainLst.append(guardar)
			
			elif partition == 'test':
				testLst.append(guardar)
			
			else:
				pass

	
		print(f'{(time.time() - start_time) / 60.0}')


	# Guardar
	print(f'\nGuardando...')
	totalColumns = len(trainLst[0]) - 2
	colsEmbeddings = [f'c{i+1}' for i in range(totalColumns)]

	columns = ['class', 'user_id'] + colsEmbeddings

	finalTrain = pd.DataFrame(trainLst, columns=columns)
	print(f'Train: {finalTrain.shape}')
	finalTrain.to_csv(os.path.join(destinyDirectory, 'GPT_train_embeddings.csv'), index=False)

	finalTest = pd.DataFrame(testLst, columns=columns)
	print(f'Test: {finalTest.shape}')
	finalTest.to_csv(os.path.join(destinyDirectory, 'GPT_test_embeddings.csv'), index=False)

	print(f'\n\nEND! :)')



## ===================================================================
def csvToParquet(csvFilename, parquetFilename, partition, model):

	df = dd.read_csv(csvFilename)

	name_function = lambda x: f'{model}_{partition}-{x}.parquet'
	df.to_parquet(parquetFilename, name_function=name_function, compression='gzip')  


def convertParquetEmbeddings(sourceDirectory):

	csvLst = [file for file in os.listdir(sourceDirectory) if file.endswith('.csv')]

	for file in csvLst:
		
		print(f'*** {file} ***')

		partition = file.replace('.csv', '').split('_')[1]
		model = file.replace('.csv', '').split('_')[0]

		parquet_file = os.path.join(sourceDirectory, f'{model}_{partition}')

		csvToParquet(os.path.join(sourceDirectory, file), parquet_file, partition, model)



## ===================================================================
def process_parquet_files_dask(input_folder, output_file):
	"""
	Lee archivos Parquet, agrupa por usuario, calcula promedios y guarda en CSV usando Dask.

	Args:
		input_folder (str): Ruta a la carpeta con archivos Parquet.
		output_file (str): Ruta del archivo CSV de salida.
	"""

	# Leer todos los archivos Parquet en un DataFrame de Dask
	df = dd.read_parquet(input_folder)

	# Aggregation
	aggregate = dict([(c, 'mean') if c not in ['class', 'user_id'] else (c, 'first') for c in df.columns.tolist()])

	# Agrupar por usuario y calcular el promedio de cada columna num√©rica
	df_grouped = df.groupby('user_id').agg(aggregate)

	# Convertir el DataFrame de Dask a Pandas para guardar en CSV
	df_pandas = df_grouped.compute()

	print(f'Guardando en... {output_file}')
	print(df_pandas.shape)

	# Guardar el DataFrame en un archivo CSV
	df_pandas.to_csv(output_file, index=False)


def aggregateEmbeddings(sourceDirectory, destinyDirectory):

	for folder in os.listdir(sourceDirectory):

		print(f'*** {folder} ***')

		model = folder.split('_')[0]
		partition = folder.split('_')[1]

		# if model in ['Bert', 'MentalBert', 'RoBERTa', 'MentalRoBERTa', 'fastText', 'GloVe', 'GPT']:
		if model in ['GPT'] and '.csv' not in folder:

			input_folder = os.path.join(sourceDirectory, folder)
			output_file = os.path.join(destinyDirectory, f'Embeddings-{model}_ENG', f'{partition}_eng.csv')

			process_parquet_files_dask(input_folder, output_file)





## ===================================================================
## PASO 1
sourceDirectory = r'D:\Users\Downloads\Anorexia'
destinyDirectory = r'eRisk_anorexia_2018\Embeddings'
processGptEmbeddings(sourceDirectory, destinyDirectory)



# ------------------------------------
## {"id": "batch_req_67077c2f604881909155d9757ba7037c",
# "custom_id": "eat_test_s9419_t18",
# "response": {"status_code": 200, "request_id": "4466cdb06ec5f5d47c80e32859d486b6",
# "body": {"object": "list", "data": [{"object": "embedding", "index": 0,
# "embedding": [-0.008633104, 0.010911978, -0.011910024, 0.01734938, 0.03859114, 0.00988898, 0.01211795, 0.045976687, -0.048671413, 0.0044329907, 0.016742233, -0.009880663, 0.011602293, -0.03054023, -0.00875786, 0.0185304, -0.043548107, -0.00070331106, -0.032819103, -0.04477903, 0.029425744, 0.010013736, 0.013623338, 0.04008821, -0.027230041, -0.00983076, 0.026597945, 0.004865478, -0.014396824, 0.0009512633, -0.008965787, 0.020276982, 0.05805305, 0.02471829, 0.012068048, 0.007859618, 0.04760683, 0.017582256, 0.033051983, -0.0070445463, -0.021873858, 0.0062876944, 0.011976561, 0.023487367, 0.0074146553, -0.02876038, 0.027213408, -0.029758427, -0.011901707, 0.010013736, -0.0051773675, -0.005959171, 0.04777317, 0.008462604, 0.013340558, 0.036395438, 0.03463222, 0.05562447, -0.008383593, -0.0036595047, 0.03539739, 0.0021957029, 0.0008426217, 0.020459957, -0.053861257, -0.023820048, -0.02856077, 0.014879214, -0.025816143, 0.0037198034, -0.013265705, -0.017282842, -0.0009122771, 0.017482452, -0.0199443, 0.0170666, 0.048438534, 0.022605758, -0.004994392, 0.03463222, 0.02754609, -0.010570978, -0.0030669144, -0.004749039, -0.013864532, -0.032952175, -0.008549933, -0.0655384, 0.016334698, -0.021025518, 0.0036491083, -0.024751559, 0.008441812, -0.033185054, 0.010629198, 0.014430093, -0.032220274, 0.0050526117, -0.029259402, 0.054393545, 0.012259341, -0.03293554, -0.033417933, -0.037892506, -0.038191922, -0.0067451326, -0.0027072018, 0.0069489004, -0.042816203, -0.047806438, -0.003971394, 0.006063134, -0.018946253, 0.050301556, -0.005297965, 0.018031377, 0.02155781, -0.029475646, 0.03785924, -0.04121933, -0.0021166909, -0.03446588, -0.039389577, -0.0153865535, 0.0010926533, 0.021208493, -0.021275029, -0.011252977, 0.00788041, 0.0071360343, -0.04907063, -0.010429588, -0.0028693844, 0.012650242, 0.031238863, -0.017216306, -0.0012184487, 0.0036678216, 0.005318757, 0.029558817, 0.0206263, -0.033484466, -0.03256959, 0.017049965, 0.0061005605, 0.0036511875, -0.0020345598, 0.03536412, -0.022589125, 0.014787726, -0.0101551255, -0.037759434, 0.034798563, 0.015943797, -0.0045660636, 0.007302375, -0.015860626, -0.01460475, -0.02613219, -0.01873001, -0.0035243526, -0.029824963, 0.035330854, 0.047872975, -0.020742739, -0.020193812, 0.00050889986, 0.020692835, -0.035763342, 0.040021673, 0.02969189, 0.013415411, 0.0032103837, -0.03839153, -0.008071703, 0.017216306, 0.0341332, 0.00026575592, -0.023553902, 0.005955012, 0.001319293, 0.008832714, 0.012359145, -0.014554848, -0.0026489825, -0.031005984, 0.033201687, 0.0050941966, -0.013115997, -0.0065413644, -0.046342637, 0.028627306, 0.042450253, -0.032669395, 0.045644004, 0.019528447, 0.0058011464, -0.029026525, -0.0033912796, 0.028494233, 0.008599836, -0.021275029, 0.013523533, -0.026182093, -0.014064142, 0.012142902, -0.016983429, -0.0028485917, 0.050467897, -0.06367538, 0.024285804, 0.0137480935, -0.03539739, 0.0013723143, -0.019844497, -0.013540167, -0.008495873, -0.0029151281, -0.046309367, 0.017382648, 0.026797555, -0.031122424, -0.026830822, 0.0025533363, -0.013822947, -0.032552958, 0.021873858, 0.012292609, -0.021008883, -0.003150085, 0.008408544, -0.033268224, 0.019362107, -0.02070947, -0.021058787, -0.02455195, -0.010371369, -0.0078720935, -0.03899036, 0.06131334, -0.00988898, -0.0056805494, -0.05602369, -0.047174342, 0.04161855, -0.010454539, -0.008283787, 0.005102514, 0.03449915, -0.05356184, 0.019312205, 0.02107542, 0.012334194, 0.018779913, -0.023936488, 0.0027072018, 0.042051036, 0.026514774, -0.025117509, 0.01751572, 0.012201121, 0.028228087, -0.015677651, 0.012009829, -0.0035617792, -0.021025518, -0.063176356, 0.022788733, 0.020875812, 0.018197719, -0.037959043, -0.022955075, 0.036129292, -0.00409615, -0.013806313, -0.002898494, -0.022905173, 0.021541175, 0.021541175, -0.04082011, 0.001985697, -0.025949216, 0.028643942, 0.045843612, -0.017815134, -0.01889635, 0.016991746, 0.031039253, -0.028161552, 0.0057554026, -0.027030433, 0.0050734044, -0.0003378804, -0.0434483, 0.025466826, 0.019412009, -0.021790687, 0.033551004, -0.006670279, 0.018863084, -0.03285237, -0.060647972, -0.009656102, -0.0391567, 0.0072025703, 0.02099225, 0.020909078, 0.009065591, 0.019794593, -0.023271123, 0.057088275, -0.017914938, -0.038690943, -0.020909078, -0.011710415, -0.009955516, 0.013082729, 0.00158232, -0.040254552, 0.0062793773, -0.014820994, 0.026015751, -0.059117634, 0.051233064, 0.020293618, 0.03802558, -0.030240815, 0.007102766, 0.004457942, -0.0007241037, 0.0153117, -0.04853834, 0.001539695, 0.027096968, 0.021990295, -0.04724088, -0.002992061, 0.003960998, 0.0063833403, 0.031371936, -0.0049652825, -0.030373888, -0.02604902, -0.033351395, 0.0062960116, -0.026082288, 0.012076366, -0.011876756, 0.015902212, 0.03596295, 0.00093306974, 0.003387121, -0.0026968054, -0.02325449, 0.015968747, -0.022123368, 0.03361754, -0.0028153234, -0.011319513, 0.02095898, -0.017998109, -0.027945308, 0.017898304, 0.0027675005, 0.025749605, 0.012284292, -0.0056597567, -0.034233004, -0.024884632, 0.029791694, 0.004474576, -0.0020865414, -0.097276285, 0.032253545, -0.01844723, -0.019711424, -0.0024472938, 0.026814189, -0.0009512633, 0.008404385, -0.0042229854, -0.0129829245, 0.012142902, 0.005959171, 0.023287756, 0.008624787, -0.026098922, -0.012309243, 0.0146463355, 0.009190347, -0.0370608, -0.0026947262, -0.019162497, 0.039655723, 0.015128725, 0.018596938, 0.022605758, 0.016642429, 0.041086257, -0.01700838, -0.029558817, -0.04980253, 0.006703547, -0.0032498897, 0.017731963, 0.02406956, -0.0013847898, -0.02791204, -0.0077431793, -0.024152732, -0.0003646509, -0.027013797, 0.02584941, 0.024136096, 0.050368093, -0.020260349, 0.020559762, 0.015669333, 0.034399346, -0.012151219, 0.021757418, -0.018297523, 0.0076891184, 0.020293618, -0.05336223, 0.004387247, 0.031455107, -0.027496187, 0.013989288, -0.0068657296, -0.0046409173, -0.036362167, -0.010853758, -0.021141956, -0.0036678216, -0.022971708, 0.020726103, 0.015186944, 0.011569025, 0.0009361886, -0.016426185, -0.0017652952, -0.00040103804, -0.012733413, -0.02322122, -0.030124377, -0.012650242, -0.0072982167, -0.0159937, 0.0134569965, -0.014546531, 4.727077e-05, -0.015943797, 0.011377732, -0.0022081784, 0.018879717, -0.049403314, -0.009581248, -0.045444395, -0.0067368154, 0.0012922626, 0.014538214, -0.026065653, 0.0031771155, 0.0017725725, -0.044612687, -0.007497826, -0.0006757608, -0.015918845, 0.021291664, 0.022073466, -0.008766177, -0.0119516095, 0.018596938, -0.015819041, -0.017881671, -0.03160481, -0.042782936, 0.0017892066, -0.011444269, 0.00029967393, -0.028228087, -0.04082011, 0.014679604, 0.03197076, 0.013698191, 0.030640034, -0.0062627434, 0.017848402, 0.023903219, 0.01751572, 0.043814253, 0.008470922, -0.02011064, -0.034798563, -0.026182093, -0.04757356, -0.064174406, 0.021225126, -0.019894399, -0.0031043412, -0.00049122615, 0.022938441, 0.0051773675, 0.023953121, -0.015394871, -0.020210447, -0.018796546, 0.00751446, 0.017266208, -0.018713376, -0.0044329907, -0.016775502, -0.019694788, -0.004836368, 0.012733413, -0.010022053, -0.02011064, -0.029375842, 0.010587612, 0.014571482, -0.03523105, -0.0137480935, -0.010338101, -0.01096188, 0.014230483, -0.017648794, -0.00070383085, -0.0037260412, -0.034299538, -0.016143406, 0.031588178, 0.013756411, 0.01683372, 0.0067451326, -0.0020896604, -0.0484718, -0.00069083547, -0.006250268, 0.0011519123, -0.0206263, 0.0068740468, -0.015586163, 0.0011872598, -0.00974759, 0.002582446, 0.03879075, 0.006803352, -0.010088589, -0.0019441119, -0.03652851, -0.014005923, -0.008308739, 0.031804424, 0.030556863, 0.01596043, 0.0045120027, -0.022056833, 0.019046059, -0.00061286305, 0.020842543, -0.009864029, 0.06377519, 0.011377732, 0.004299918, -0.00601739, 0.013481948, 0.036994264, -0.020842543, -0.037326947, 0.011169806, -0.025816143, -0.02859404, -0.018829815, 0.018513767, 0.012866486, 0.024934534, 0.013099363, -0.009606199, -0.018114548, 0.020676201, -0.023520635, 0.013839581, 0.021125322, -0.0033143468, 0.0015563291, 0.015486359, -0.002133325, -0.00018232546, -0.0056763906, 0.038191922, 0.009589566, 0.032004032, 0.0052896477, -0.026231995, -0.031721253, -0.008279629, 0.016684014, 0.022389514, -0.012350828, 0.012625291, 0.004961124, -0.020077374, 0.015486359, 0.00052423443, 0.020842543, 0.046575513, -0.009348371, 0.0045951735, 0.014829311, 0.015411505, 0.012517169, 0.0018505449, 0.015053871, -0.0010531473, -0.0072940583, 0.0050692456, 0.039655723, -0.059783, -0.024003023, -0.0057512443, -0.040420894, 0.02285527, -0.011070002, 0.018962888, -0.017216306, -0.002850671, -0.02737975, -0.0009341094, -0.033867054, 0.018014744, -0.011560708, -0.0065164133, -0.012300926, -0.0023745196, 0.011377732, -0.0051773675, -0.004624283, -0.004071199, -0.053495303, -0.017499086, -0.009024005, 0.014222166, -0.031072522, -0.009431542, 0.019877763, 0.0038549555, 0.02508424, 0.013656606, 0.0131409485, 0.0053686597, 0.016259845, 0.018796546, 0.0075103017, 0.014272069, 0.0057512443, 0.021341566, -0.010928611, -0.014263751, 0.018131182, -0.00030695135, -0.0039360467, -0.019079326, 0.044479616, 0.00011767335, -0.016542625, 0.009581248, -0.0008374236, 0.016958477, -0.027030433, 0.012076366, -0.019162497, 0.012009829, 0.045244783, 0.010221662, -0.0054393546, -0.003322664, -0.006229475, -0.0046118074, 0.015128725, -0.022622392, -0.011643878, -0.018114548, 0.008633104, -0.0064540356, -0.008957469, -0.02556663, -0.008433495, 0.009365005, -0.0014918719, 0.03054023, 0.008574884, 0.04308235, -0.010013736, 0.00847508, 0.038324993, -0.026681116, -0.028743746, -0.02649814, -0.016334698, -0.009523029, -0.017881671, -0.027080335, 0.013199168, 0.003480688, 0.01734938, -0.0029463172, 0.047806438, -0.009905614, -0.029425744, 0.0049361726, 0.03376725, -0.0033205845, 0.029874865, 0.0028174028, -0.020293618, 0.023121417, -0.03782597, -0.0030357256, 0.0069197905, 0.022156637, 0.010570978, 0.0065413644, -0.042816203, -0.01986113, 0.04401386, 0.020077374, 0.01047949, 0.01804801, 0.0039027785, -0.006229475, -0.00066640414, 0.003944364, 0.017449183,
# 0.020825908, 0.0116355615, -0.005160733, 0.018580303, -0.018264255, -0.0072566313, 0.00013222819, 0.009290151, 0.010329784, -0.0006133829, 0.01759889, -0.018613571, -0.039389577, -0.0128249, 0.0177985, 0.017366013, 0.0030294876, 0.039589185, 0.010080272, -0.019395376, 0.026231995, 0.0075643626, 0.038724214, 0.0117935855, 0.008816079, -0.010205028, 0.00064197276, 0.017831769, 0.021108689, -0.0081881415, 0.0035409867, 0.025982482, 0.02932594, 0.005535001, -0.009140445, 0.019977568, -0.026548043, -0.0013931069, 0.004291601, -0.035530463, -0.0050359773, -0.026963895, -0.028444331, -0.012251023, 0.02483473, -0.013839581, -0.0021354042, -0.004054565, 0.033284858, 0.016750552, -0.0055474765, -0.004495369, -0.014396824, -0.005655598, 0.03014101, -0.0007989572, 0.010612563, -0.020410055, 0.0041730828, 0.00052137545, -0.010429588, -0.0064166086, 0.00028745824, -0.03689446, 0.02228971, 0.0050983555, 0.009473126, 0.016002016, -0.0120846825, 0.01650104, 0.010080272, 0.007393863, 0.0015781614, -0.018763278, -0.016293112, -0.0206263, 0.014321971, 0.045111712, -0.002827799, 0.006853254, 0.010238296, 0.0035721755, -0.01864684, 0.0022144162, -0.028510869, -0.014762774, -0.015552895, -0.00808002, 0.004370613, -0.018796546, 0.0012423602, 0.02568307, 0.011494172, -0.010138491, -0.0062960116, -0.009681053, 0.027279943, -0.018463865, 0.023387562, 0.004844685, -0.01573587, 0.0072399974, 0.004923697, -0.014870896, 0.0076849596, -0.021341566, 0.011818537, 0.010462857, 0.0007303415, 0.010030369, 0.02180732, 0.00044886113, 0.0012745889, 0.030390523, -0.0040836744, 0.0026032384, 0.004969441, -0.012716779, 0.021025518, 0.013623338, -0.012625291, -0.0030918657, 0.0053686597, -0.0011061685, -0.012791633, 0.010521076, -0.002497196, -0.014080776, 0.0053270743, -0.0011061685, -0.01265856, 0.024368973, 0.015186944, -0.015053871, -0.00015412545, 0.0005322916, 0.0028860185, 0.0159937, 0.021507908, 0.011818537, -0.009947199, 0.002804927, 0.0006487304, 0.004811417, 0.011569025, -0.010878709, -0.034931634, -0.0033247431, -0.002472245, -0.0012433999, 0.0025096717, 0.0015698443, -0.009406591, 0.003466133, 0.0026988846, 0.025866045, 0.017931573, -0.018014744, 0.006237792, 0.0177985, -0.0019555478, 0.016958477, 0.01630143, -0.0004127339, 0.014213849, 0.0011831012, 0.006449877, 0.02754609, 0.00034827672, -0.0015126646, 0.020177178, 0.0014627622, 0.008583202, 0.025267215, -0.02248932, -0.00288186, -0.0066494863, 0.0025845252, 0.013348875, 0.013407094, -0.0058926344, 0.0017528195, 0.007073656, -0.0039817905, 0.026082288, -0.0022871904, 0.0014138995, 0.00590511, 0.0022144162, -0.0033517736, 0.003528511, -0.004073278, -0.010995148, 0.005489257, 0.00799269, 0.019029424, -0.011203075, -0.029858232, 0.012683511, -0.0008696522, -0.0077722888, -0.005181526, 0.014895847, -0.0057138177, -0.020326884, -0.00322078, 0.008262996, -0.015868943, 0.007576838, 0.021690883, -0.0085333, -0.020676201, -0.0009138365, 0.022073466, -0.008229727, -0.0061546215, -0.0066744373, 0.02144137, 0.0030523597, 0.0005551635, -0.014047508, -0.008483397, 0.014363556, -0.0030232498, 0.00025406008, -0.02302161, 0.0035097976, 0.0009044798, -0.0021769893, -0.0054601473, 0.016143406, -0.0042500156, -0.017981475, -0.012700144, -0.020177178, 0.0023059037, -0.022871904, 0.015137042, 0.023936488, -0.0067617665, 0.0023495683, -0.0025491777, -0.016259845, 0.0004254694, 0.0058967927, -0.023088148, -0.035530463, 0.007144351, 0.019095961, -0.00056971837, -0.009206981, 0.0075726793, 0.008624787, 0.0008774494, -0.014588117, -0.008308739, -0.004104467, 0.0028174028, 0.004536954, -0.0010157204, 0.030457059, -0.02042669, -0.010512759, 0.015794089, -0.01949518, -0.0006191009, 0.009057274, -0.0013120156, 0.008350324, 0.002395312, -0.014421775, -0.011111587, 0.012675193, 0.005040136, -0.016800454, 5.506801e-05, 0.003859114, -0.012891437, -0.009589566, -0.0059259026, -0.0013639972, -0.005709659, -0.002237288, 0.0056264885, 0.01901279, 0.0058884756, 0.003655346, 0.0023849157, 0.014313653, -0.0015573688, 0.016184991, 0.004503686, -0.0044621006, 0.0040608025, 0.0022476844, -0.02568307, -0.004048327, -0.015303384, -0.007385546, 0.0018765358, -0.013032827, 0.0010999306, -0.021873858, -0.0049735997, -0.015261798, -0.023470731, -0.00066120597, -0.012675193, -0.0005421681, 0.018846449, 0.014538214, 0.014546531, 0.0013234515, -0.019694788, 0.01873001, 0.0015355365, 0.01585231, 0.009922248, 0.01596043, -0.004416357, 0.003166719, -0.013282338, 0.001607271, -0.014696238, -0.00040831548, 0.008965787, -0.0044787345, 0.007647533, 0.033051983, -0.002842354, 0.022422783, -0.009223615, 0.012957973, 0.004204272, -0.0067160227, -0.0034536575, -0.0015105853, 0.0107373195, 0.019062692, 0.016434502, 0.018147817, -0.012159536, 0.0058302563, 0.0073730703, -0.010986831, 0.019312205, 0.008059227, -0.017665427, 0.008138239, 0.016143406, 0.003938126, 0.007497826, -0.0069239493, -0.01768206, -0.020676201, -0.037959043, -0.010504441, -0.007639216, -0.020559762, -0.001878615, 0.031887595, -0.013847899, -3.41779e-05, -0.01254212, -0.018413963, 0.020742739, -0.00027212367, -0.013215802, -0.0025450191, -0.015835674, -0.012891437, -0.006803352, -0.0054393546, 0.0069031566, 0.009664419, 0.007971899, 0.027163506, 0.014280385, 0.014014239, -0.010878709, 0.0064956206, 0.012051414, 0.016060235, -0.008055069, 0.014920798, -0.001661332, 0.005189843, -0.014737823, 0.0075477283, -0.0042021926, -0.023919852, -0.0044912104, -0.0029172073, 0.016176675, 0.01409741, 0.025416924, 0.0085333, 0.0049320143, 0.0047615147, -0.004757356, -0.0066661206, 0.0029629513, -0.0022040198, 0.004474576, 0.011569025, 0.0115024885, -0.022639027, -0.02811165, 0.00094970386, -0.019877763, 0.0057221344, -0.011045051, 0.0018547035, -0.00026289694, -0.010088589, 0.0070071197, -0.02370361, 0.0045120027, 0.025250582, 0.026548043, 0.012184487, -0.00576372, 0.005630647, 0.0062669017, -0.00055048516, 0.007111083, -0.010945246, -0.018031377, 0.008134081, -0.0021998612, -0.011452586, -0.019328838, 0.0058385734, 0.01912923, -0.0024847204, 0.008849348, -0.0007345, -0.008146556, -0.013282338, -0.004424674, -0.011959926, 0.010263247, 0.0007828429, 0.02455195, -0.02386995, 0.00669523, 0.0111864405, -0.014163947, 0.007281583, 0.008167349, 0.0058302563, 0.0041086255, -0.002977506, -0.020742739, -0.008142398, 0.0040524853, -0.00997215, 0.0020012916, 0.030972717, 0.0030419633, -0.006969693, 0.0042791255, 0.00031682785, 0.00421051, -0.011394367, -0.039755527, 0.010080272, -0.021225126, 0.006990486, 0.0012777077, -0.008450129, -0.004424674, 0.0076350574, -0.009730956, -0.008113288, -0.02782887, 0.007818033, 0.006167097, -0.023121417, 0.006740974, 0.016916892, -0.011219708, 0.009631151, 0.009024005, 0.0101551255, 0.020559762, -0.002757104, 0.00021325452, -0.003181274, 0.015777456, 0.007481192, 0.006520572, -0.0028943354, -0.01986113, -0.008021801, 0.0050983555, 0.0055183666, 0.004711612, -0.00046861413, -0.0061463043, 0.024485413, -0.0058177807, 0.0048238924, -0.023670342, -0.038690943, -0.004362296, -0.011228026, 0.00081455166, -0.016043602, -0.0028777013, 0.018230988, 0.015053871, 0.020193812, 0.0026115556, 0.0108953435, 0.017582256, 0.021990295, 0.017149769, 0.009789175, 0.0014534056, -0.010645832, -0.028061748, 0.013307289, -0.007818033, -0.00562233, -0.017548988, 0.009107176, 0.024851363, 0.026448239, 0.013057778, 0.012359145, 0.00073346036, -0.02070947, -0.0013057778, -0.003977632, -0.004969441, 0.0030211706, 0.007439607, -0.028860185, 0.0059425365, -0.008038435, 0.0017944048, -0.021208493, -0.007360595, -0.0003929809, -0.02604902, 0.009589566, -0.0015656858, -0.01367324, 0.008799445, -0.012550438, 0.010770587, 0.022805369, 0.014163947, -0.0037301995, -0.0049195387, 0.031904228, 0.014421775, -0.011352781, 0.008824397, 0.0081881415, -0.018746644, 0.0143552385, -0.01017176, -0.029658621, 0.002291349, 0.012092999, -0.015278432, 0.013107681, 0.017831769, 0.010213345, -0.013756411, -0.010837124, -0.004686661, -0.014862579, 0.017665427, -0.009872345, -0.011718732, -0.031322032, 0.013773045, 0.002087581, 0.007576838, -0.009356688, 0.010271564, 0.0024202634, -0.014812677, -0.017731963, -0.010629198, 0.00054372754, 0.010745636, -0.0015365761, 0.00018284528, 0.001988816, -0.0036740594, -0.021258395, 0.0050110263, 0.0013296893, 0.024169365, -0.007269107, 0.019095961, -0.00709029, -0.0025741288, -0.013706508, -0.030573498, 0.0020855018, 0.008138239, -0.010205028, -0.021774054, -0.017765231, 0.00423754, 0.00548094, -0.0074312896, 0.00932342, -0.0131659, 0.022023564, -0.003378804, 0.016118454, -0.0019669838, 0.006079768, -0.0185304, 0.0043747714, -0.0012340432, -0.018131182, -0.011427635, -0.012384096, -0.019478545, -0.008549933, 0.011494172, 0.015137042, 0.012367463, -0.012517169, -0.0044537834, 0.0050442945, 3.378804e-05, 0.0027758174, 0.009847394, -0.019960934, 0.0045161615, -0.0036283156, 0.026581312, 0.0065579987, 0.022888537, -0.014138996, -0.009822443, -0.0034203893, 0.0067118644, -0.011452586, -0.005331233, 0.0097060045, -0.0031001826, -0.0061296704, 0.0017819293, 0.013922752, 0.0019960934, 0.019877763, -0.020210447, -0.013490265, 0.018912986, 0.03110579, 0.02034352, 0.013947703, -0.011602293, 0.013074412, -0.012575389, 0.019412009, -0.0033330603, -0.0004387247, 0.037393484, 0.0068449373, -0.0003280039, -0.015211895, 0.04684166, 0.011976561, 0.011111587, -0.010529393, -0.01680877, -0.013689875, 0.018713376, 0.01189339, 0.0064706695, 0.019245667, -0.02257249, -0.0076059476, 0.010953563, 0.012342511, 0.00036179193, 0.029558817, 0.0010344338, 0.00726079, -0.0060839267, 0.011710415, 0.015137042, 0.034332808, -0.009772541, 0.0019451515, 0.0090988595, -0.013207485, -0.013681557, -0.009514712, 0.008683006, 0.025799507, 0.011627245, 0.006079768, 0.002291349, 0.0084917145, -0.021291664, 0.00036309147, 0.012076366, -0.01460475, -0.0043498203, -0.007551887, -0.0017330665, 0.010670783, -0.011602293, 0.0015698443, -0.01804801, 0.028876819, 0.016268162, -0.004420515, 0.015802406, -0.015195262, 0.0199443, 0.011311196, 0.013357192, -0.0036844558, 0.0006560078, 0.0032706822, 0.0031958288, 0.01039632, 0.0019992124,
# 0.013357192]}], "model": "text-embedding-3-large", "usage": {"prompt_tokens": 5, "total_tokens": 5}}}, "error": null}



## ===================================================================
## PASO 2
convertParquetEmbeddings(r'eRisk_anorexia_2018\Embeddings')




## ===================================================================
## PASO 3
sourceDirectory = r'eRisk_anorexia_2018\Embeddings'
destinyDirectory = r'eRisk_anorexia_2018\Partitions'
aggregateEmbeddings(sourceDirectory, destinyDirectory)
